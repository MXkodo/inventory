<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="/public/css/main.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/public/js/js.js"></script>
    <title>Main</title>
  </head>
  <body>
    <!--Тут таится модальное окно-->
    <div id="openModal" class="modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Добавить Пк</h3>
            <a href="#close" title="Close" class="close">×</a>
          </div>
          <div class="modal-body">
            <form id="myForm" action="/items" method="post" align="center">
              <p>Инв. номер</p>
              <input type="text" name="invnumber" required />
              <p>Название</p>
              <input type="text" name="name" required />
              <p>Хранение</p>
              <input type="text" name="storage" required />
              <p>Бюджет</p>
              <input type="checkbox" name="budget" required />
              <p>Описание</p>
              <textarea name="desc"></textarea>
              <button type="submit">Добавить</button>
            </form>

            <script>
              document
                .getElementById("myForm")
                .addEventListener("submit", function (event) {
                  event.preventDefault();

                  const formData = new FormData(event.target);
                  const data = Object.fromEntries(formData.entries());
                  data.budget = data.budget === "on";
                  const jsonData = JSON.stringify(data);

                  fetch("/items", {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: jsonData,
                  })
                    .then((response) => response.json())
                    .then((data) => console.log(data))
                    .catch((error) => console.error("Ошибка:", error));
                });
            </script>
          </div>
        </div>
      </div>
    </div>
    <header>
      <div class="hat test">
        <div class="head test logo">
          <div class="box-1 test">
            <a href="/"><img class="agtu" src="/public/img/logo.svg" /></a>
          </div>
        </div>
        <div class="head test pk">
          <div class="box-2 test">
            <a href="#openModal"
              ><img class="add" src="/public/img/add.png"
            /></a>
          </div>
          
          <div class="pk-1">
            <img class="pk-2" src="/public/img/pk.svg" />
          </div>
          <div><article><p>Список <br>компьютеров</p></article></div>
          
          <img class="line-button-1" src="/public/img/line-button.svg" />
          
          <div class="jurnal-1">
            <img class="jurnal-2" src="/public/img/jurnal.svg" />
          </div>
          <div><article><p>Журнал <br>событий</p></article></div>

          <div class="archiv-1">
            <img class="archiv-2" src="/public/img/archiv.svg" />
          </div>
          <div><article>Архив</article></div>

         
        </div>  

          

        <div class="head test">
          <div class="box-3 test">
            <input
              type="text"
              type="image"
              class="Search"
              placeholder="Поиск"
              src="/public/img/poisk.svg"
            />
          </div>
          <div class="profile">
            <ul>
              <li>
                <a
                  ><img
                    class="add profile"
                    src="/public/img/icons8-пользователь-мужчина-в-кружке-96-1.png"
                /></a>
                <ul class="helper">
                  <script>
                    function logout() {
                      fetch("/logout", {
                        method: "GET",
                        headers: {
                          "Content-Type": "application/json",
                        },
                      })
                        .then((response) => response.json())
                        .then((data) => {
                          console.log(data);
                          window.location.href = "/login";
                        })
                        .catch((error) => {
                          console.error("Ошибка при выходе:", error);
                        });
                    }
                  </script>
                  <li class="login">Кабан Кабаныч></li>
                  <li><a class="exit" href="#" onclick="logout()">EXIT</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>
    <div class="bone">
      <table class="second" id="itemsTable">
        <thead>
          <tr>
            <th>Инв. номер</th>
            <th>Наименование</th>
            <th>Склад</th>
            <th>Дата</th>
            <th>Бюджет</th>
            <th>&#9998;</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <script>
      $(document).ready(function () {
        $.get("/items", function (data) {
          var items = data.items;
          var tableBody = $("#itemsTable tbody");
          tableBody.empty();

          items.forEach(function (item) {
            var row = $("<tr>");
            row.append($("<td>").text(item.invnumber));
            row.append($("<td>").text(item.name));
            row.append($("<td>").text(item.storage));
            row.append($("<td>").text(item.date));
            row.append($("<td>").text(item.budget ? "Да" : "Нет"));

            var changeButton = $('<button class="change">Подробнее</button>');
            changeButton.attr("data-item", JSON.stringify(item));
            row.append(
              $("<td>").html(
                '<a href="/public/templates/edit.html?id=' +
                  item.id +
                  '">' +
                  changeButton.prop("outerHTML") +
                  "</a>"
              )
            );
            tableBody.append(row);
          });
        });

        $(document).on("click", ".change", function (e) {
          e.preventDefault();

          var item = JSON.parse($(this).attr("data-item"));
          if (item) {
            console.log("Item fetched:", item);
            localStorage.setItem("selectedItem", JSON.stringify(item));
            console.log(
              "Item stored in localStorage:",
              localStorage.getItem("selectedItem")
            );
            window.location.href = $(this).closest("a").attr("href");
          } else {
            console.error("Item is undefined");
          }
        });
      });
    </script>
  </body>
</html>
